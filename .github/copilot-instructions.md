This project is a GBA ROM (Pokemon Emerald) build with C and ARM assembly, driven by a custom make-based toolchain. These instructions focus on what an AI coding agent needs to be productive working in this codebase.

- **Big picture:** The repo produces `pokeemerald.gba` via a multi-step build that compiles C (`src/`), assembles hand-written ARM assembly (`asm/`, `data/*.s`), links with `ld_script_modern.ld`, then post-processes with `tools/gbafix`. The canonical build output and intermediates live under `build/emerald`.

- **Key directories:**
  - **src/**: C source, main game logic (compile targets found in `Makefile`).
  - **asm/**: assembly macros and handcrafted ASM overlays.
  - **data/**: assembly data, script sources, and generated `.inc` includes.
  - **include/**: shared include files used by C and assembler.
  - **graphics/**: art assets and rules (used by graphics build rules).
  - **tools/**: small local tools used in the build (e.g. `poryscript`, `scaninc`, `preproc`, `gbafix`).

- **Build / common commands:**
  - Build: `make -j<N>` (example used: `make -j 16`).
  - Clean: `make clean`.
  - Tool invocation examples (used by the Makefile):
    - `tools/poryscript/poryscript -i data/maps/.../scripts.pory -o data/maps/.../scripts.inc -fc tools/poryscript/font_config.json -cc tools/poryscript/command_config.json`
    - `tools/scaninc/scaninc -M build/emerald/src/pokemon.d -I include -I tools/agbcc/include src/pokemon.c`
    - `tools/preproc/preproc data/event_scripts.s charmap.txt | arm-none-eabi-cpp -iquote include ... | arm-none-eabi-as -mcpu=arm7tdmi -march=armv4t ... -o build/emerald/data/event_scripts.o`
  - Toolchain: `arm-none-eabi-gcc/ld/objcopy` are required and used extensively.

- **Why some custom tools exist:**
  - `tools/preproc`, `tools/scaninc` and `tools/poryscript` prepare game-specific .inc files and perform text preprocessing not handled by plain gcc/as. Inspect `tools/` before replicating behavior with other tools.

- **Conventions & patterns to follow:**
  - Data and scripts often live as assembly `.s` that are preprocessed into object files; look for `.inc` files under `data/` that are generated by tools — do not manually edit generated `.inc` files without changing the generator.
  - Build flags like `MODERN=1` and `TESTING=0` are set by the Makefile; these change compiled code paths. Search for `MODERN` in `include/` and `ld_script_modern.ld` to understand conditional layout.
  - Use `include/` for headers shared between assembler and C; naming and macros in `asm/macros.inc` are commonly reused.

- **Files to inspect for architecture & behavior:**
  - `Makefile` — top-level build orchestration.
  - `ld_script_modern.ld` — ROM memory layout and section placement.
  - `src/` entry points and `main` equivalents in C.
  - `asm/macros.inc` and `constants/` — frequently used macros and global constants.

- **Tests & validation:**
  - The primary validation is building the ROM and running it in an emulator. The build produces `pokeemerald.gba` and `pokeemerald.elf` in `build/emerald`.
  - Memory usage is monitored during link (see `arm-none-eabi-ld` output and `pokeemerald.map`). Watch EWRAM/IWRAM usage — they are often near capacity.

- **Common developer workflows:**
  - Add C code: place under `src/`, update appropriate Makefile lists if adding new translation units.
  - Add assembly/data: put in `asm/` or `data/`, ensure any generator (e.g., `poryscript`) is updated if you add script sources.
  - Add graphics: add to `graphics/` and update the relevant `*_rules.mk` file if creating new asset types.

- **Integration points / external deps:**
  - External toolchain: `arm-none-eabi-*` (gcc, as, ld, objcopy).
  - Python and other runtime dependencies for scripts in `tools/` (check tool shebangs and README). Many `tools/` binaries are compiled and shipped in the repo, but building from source may require a local build step.

- **Examples of in-repo patterns to mimic:**
  - Generated include flow: `data/*.s` -> `tools/preproc`/`arm-none-eabi-cpp` -> `.o` (see build log invocations in `Makefile`).
  - Map script generation with `poryscript` that converts `.pory` to `.inc` (see `data/maps/*/*.pory` usage).

- **When editing files, be careful:**
  - Avoid editing generated `.inc` artifacts under `data/` — change the source generator inputs instead.
  - Keep an eye on linker output and `.map` changes; section placement matters for ROM behavior.

If any sections above are unclear or you want small example patches (e.g., add a new map script, or wire a small `src/` file into the build), tell me which area and I'll draft a precise change and test it by running the build.
